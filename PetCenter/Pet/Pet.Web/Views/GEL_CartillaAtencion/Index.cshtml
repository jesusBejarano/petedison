<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Pet Center - Gestion de Exámenes de Laboratorio, Rayos X y Otros</title>
		<link href="css/bootstrap.css" rel="stylesheet">
		<link href="css/font-awesome.min.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">
        <link href="css/jquery-ui.css" rel="stylesheet" />
       
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

	</head>
	<body>
        <input type="hidden" id="idComprobante" value="" />       
        <input type="hidden" id="idCliente" value="" />       
        <input type="hidden" id="idPaciente" value="" />       
		<div id="header">
			<div class="logo-group">
				<span class="logo"> <img src="img/petcenter.png"> </span>
				<span class="nombre-sistema"> </span>
			</div>
			<div class="user-group">
				<div id="logout" class="btn-header salir">
					<span> <a href="login.html" title="Cerrar sesión"><i class="fa fa-sign-out"></i></a> </span>
				</div>
				<div class="usuario hidden-xs text-right">
					<div class="usuario-nombre">Johan Muñoz</div>
					<div class="cargo">Administrador</div>
				</div>
			</div>
		</div>

        @Html.Partial("/Views/Shared/_Cabecera.cshtml")

		<div id="cuerpo">
			<div id="content">
				<div class="row">

					<div class="col-xs-12 col-sm-7 col-md-8 col-lg-8">
						<div class="row">
							<div class="container-fluid text-left">
								<span class="h1-resultados page-title"> Cartilla de Atención </span>

							</div>
						</div>
					</div>
				</div>

                <!-- Filtro de Búsqueda del Reporte -->
                				<div class="row">
					<div class="col-sm-12">
						<div class="well">

							<div class="row">
								<div class="smart-form">
									<div class="col-sm-12 text-left">
                                        <fieldset class="scheduler-border">
                                            <legend class="scheduler-border">Filtro de Búsqueda...</legend>
                                            <div class="col-sm-4 text-left">
                                                <div class="input-group input-group-sm">
                                                    <label class="control-label input-label" for="startTime">Comprobante de Pago :</label>
                                                    <input id="txtComprobantePago" type="text" class="form-control" placeholder="Comprobante de Pago..." style="text-transform:uppercase" onfocus="limpiarCamposBusqueda();">
                                                </div>
                                            </div>
                                            <div class="col-sm-4 text-left">
                                                <div class="input-group input-group-sm">
                                                    <label class="control-label input-label" for="startTime">Número Cartilla Atención :</label>
                                                    <input id="txtCodigoCartilla" type="text" class="form-control" placeholder="Número Cartilla Atención..." style="text-transform:uppercase" onfocus="limpiarCamposBusqueda();">
                                                </div>
                                            </div>
                                            <div class="col-sm-4 text-left">
                                                <div class="input-group input-group-sm">
                                                    <label class="control-label input-label" for="startTime">Nombre del Paciente :</label>
                                                    <input id="txtNombrePaciente" type="text" class="form-control" placeholder="Nombre del Paciente..." style="text-transform:uppercase" onfocus="limpiarCamposBusqueda();">
                                                </div>
                                            </div>
                                            <div class="col-sm-12">&nbsp;</div>
                                            <div class="col-sm-4 text-left">
                                                <div class="input-group input-group-sm">
                                                    <label class="control-label input-label" for="startTime">Estado Cartilla de Atención :</label>
                                                    <!--input id="txtEstadoCartilla" type="text" class="form-control" placeholder="Estado Cartilla de Atención..." style="text-transform:uppercase"-->
                                                    <select id="cboEstado" onfocus="limpiarCamposBusqueda();">
                                                        <option value="0" selected>-- Seleccione --</option>
                                                        <option value="1">TODOS</option>
                                                        <option value="2">PENDIENTE DE ASIGNACION</option>
                                                        <option value="3">PENDIENTE DE REGISTRO</option>
                                                        <option value="4">PENDIENTE DE APROBACION</option>
                                                        <option value="5">APROBADO</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-sm-4 text-left">
                                                <div class="input-group input-group-sm">
                                                    <table class="table table-striped table-hover"  style="background-color:#FFD54F">
	                                                    <thead >
		                                                    <tr><th colspan="4">Fechas:</th></tr>
		                                                    <tr>
			                                                    <td>Desde:</td>
			                                                    <td><input type="date" id="desdeDay" style="height:30px"></td>
			                                                    <td>Hasta:</td>
			                                                    <td><input type="date" id="hastaDay" style="height:30px"></td>
		                                                    </tr>
	                                                    </thead>
                                                    </table>
                                                </div>
                                            </div>

                                            <!--div class="col-sm-4 text-left">
                                                <div class="input-group input-group-sm">
                                                    <label class="control-label input-label" for="startTime">Fecha Desde :</label>
                                                    <input type="date" id="desdeDay" max="1979-12-31">
                                                </div>
                                            </div>
                                            <div class="col-sm-4 text-left">
                                                <div class="input-group input-group-sm">
                                                    <label class="control-label input-label" for="startTime">Fecha Hasta :</label>
                                                    <input type="date" id="hastaDay" max="1979-12-31">
                                                </div>
                                            </div-->
                                        </fieldset>
									</div>
								</div>
								<div class="smart-form">
									<div class="col-sm-12 text-right">
										<button type="submit" class="btn btn-sm btn-primary" data-toggle="modal" onclick="filtroBuscar();">
											Buscar
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

                <!-- Cuerpo del Reporte -->
				<div class="row">
					<div class="col-sm-12">
						<div class="well">

							<div class="row">
								<div class="smart-form">
									<div class="col-sm-12 text-left">
										<button type="submit" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#myModal">
											Registrar
										</button>
									</div>
								</div>
							</div>
							<!--div class="separa-20"></div>
							<div class="row">
								<div class="col-xs-12">
                                    <table id="dataGrid" style="text-align: center;"></table>  
                                    <div id="pager" class="tablecontainer"></div> 
								</div>
							</div-->

                            <div class="separa-20"></div>
							<div class="row">
								<div class="col-xs-12" id="cbtabla">
                                    <div id="tabAtencionMedica" class="tablecontainer"></div>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>


		<!-- Modal -->
        <div id="myModal" class="modal fade" role="dialog">
		    <div class="modal-dialog">
		        <!-- Modal content-->
		        <div class="modal-content">
		            <div class="modal-header">
		                <button type="button" class="close" data-dismiss="modal">&times;</button>
		    	        <strong>Registro de Cartilla de Atención</strong>
		            </div>

			        <div class="panel-body">
                        <div class="row">
                            <div class="col-xs-12">
                                <table class="table table-striped table-hover">
                                    <thead >
                                        <tr style="background-color:#FFD54F">
                                            <td>Ingrese Número de Comprobante:</td>
                                            <td> 
                                                <label class="select">
                                                    <input type="text" id="txtNumeroComprobante"   name="txtNumeroComprobante"  placeholder="Número Comprobante"  style="width:200px">
                                                    <span class="error" style="visibility:hidden">Ingrese Número Comprobante</span>
                                                </label>
                                            </td>
                                            <td><button type="submit" id="findComprobante" class="btn btn-sm btn-default" onclick="buscarComprobante();">Buscar</button></td>
                                        </tr>										
                                    </thead>
                                </table>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-12">
                                <table class="table table-striped table-hover"  style="background-color:#FFD54F">
                                    <thead >
                                        <tr><th colspan="4">Datos de Cliente:</th></tr>
                                        <tr>
                                            <td>Dni:</td>
                                            <td><span id="dniCliente"></span></td>
                                            <td>Nombre:</td>
                                            <td><span id="nombreCliente"></span></td>
                                        </tr>
                                        <tr>
                                            <td>Teléfono:</td>
                                            <td><span id="telefonoCliente"></span></td>
                                            <td>Celular:</td>
                                            <td><span id="celularCliente"></span></td>
                                        </tr>
                                        <tr>
                                            <td>Correo:</td>
                                            <td colspan="3"><span id="correoCliente"></span></td>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-12">
                                <table class="table table-striped table-hover"  style="background-color:#FFD54F">
                                    <thead >
                                        <tr><th colspan="4">Datos de Paciente:</th></tr>
                                        <tr>
                                            <td>Nombre:</td>
                                            <td><span id="nombrePaciente"></span></td>
                                            <td>Tipo:</td>
                                            <td><span id="tipoPaciente"></span></td>
                                        </tr>
                                        <tr>
                                            <td>Raza:</td>
                                            <td><span id="razaPaciente"></span></td>
                                            <td>Color:</td>
                                            <td><span id="colorPaciente"></span></td>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-12">
                                <div class="col-sm-4"><b>Exámenes Programados</b></div>
                                <div class="col-sm-6" id="cblist">
                                    <!--input type="checkbox" value="" id="cb1" />
                                    <label for="cb1"></label-->
                                </div>
                            </div>
                        </div>
                        <div class="separa-20"></div>
                        <div class="row">
                            <div class="col-sm-4"><b>Jefe Laboratorio</b></div>
                            <div class="col-sm-6">
                                <div class="con-json">
                                    <select id="cboJefes"></select>
                                </div>
                                <span class="error" style="visibility:hidden">Seleccione Jefe Laboratorio</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-3"></div>
                            <div class="col-sm-6">
                                <button type="button" id="btnGuardar" class="btn btn-sm" onclick="grabarCartilla();">Guardar</button>
                                <button type="button" class="btn btn-sm" data-dismiss="modal"> Cerrar</button>
                            </div>
                        </div>
		            </div>
		            <div class="modal-footer">				
		            </div>
		        </div>
		    </div>
        </div>

        <script src="js/external/jquery/jquery.js"></script>
        <link href="Scripts/jquery-ui.min.css" rel="stylesheet" />
        <script src="Scripts/jquery-ui.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/bootswatch.js"></script>


        <!-- JQgrid -->
        <link type="text/css" href="css/JQGrid/jquery-ui-1.9.2.custom.css" rel="stylesheet" />
        <link type="text/css" href="css/JQGrid/ui.jqgrid.css" rel="stylesheet" />

        <script type="text/javascript" src="js/JQGrid/jquery-1.8.3.js"></script>
        <script type="text/javascript" src="js/JQGrid/jquery-ui-1.9.2.custom.js"></script>
        <script type="text/javascript" src="js/JQGrid/grid.locale-en.js"></script>
        <script type="text/javascript" src="js/JQGrid/jquery.jqGrid.min.js"></script>

        <!-- Mensajes Alerta -->
        <script type="text/javascript" src="js/alertify.js"></script>
		<link rel="stylesheet" href="css/alertify.core.css" />
		<link rel="stylesheet" href="css/alertify.default.css" />

        <script type="text/javascript">
            function editar(id) {
                // alert(id);
                //ocument.getElementById("txtEditar").value(id);
                // $(editarSolicitud(id));
            }
            $(document).ready(function () {

                $(function () {

                    /* Este Grid es el que mejor se cre */
                    $("#dataGrid").jqGrid({
                        url: '/CartillaAtencion/listarCartillaAtencion/',
                        datatype: 'json',
                        mtype: 'POST',
                        serializeGridData: function (postData) {
                            alert(postData.rows);
                            console.log(postData);
                            return JSON.stringify(postData);
                        },
                        contentType: "application/json",
                        success: function (data) {
                            console.log(data);
                        },
                        error: function (xqr, errorMessage) {
                            alert(errorMessage);
                        },
                        ajaxGridOptions: { contentType: "application/json" },
                        loadonce: true,
                        colNames: ['Nro Comprobante', 'Nombre Cliente', 'Paciente', 'Nombre Empleado', 'Código', 'Fec.Creación', 'Estado'],
                        colModel: [
                                        { name: 'numero_comprobante', index: 'Nro Comprobante', width: 120 },
                                        { name: 'nombre_cliente', index: 'Nombre Cliente', width: 245 },
                                        { name: 'nombre_paciente', index: 'Paciente', width: 100 },
                                        { name: 'nombre_empleado', index: 'Nombre Empleado', width: 200 },
                                        { name: 'codigo', index: 'Código', width: 80 },
                                        { name: 'fecha_creacion', index: 'Fec.Creación', width: 100 },
                                        { name: 'estado_cartilla', index: 'Estado', width: 80 }
                        ],
                        pager: '#pager',
                        rowNum: 5,
                        rowList: [10, 20, 30],
                        viewrecords: true,
                        gridview: true,
                        jsonReader: {
                            page: function (obj) { return 1; },
                            total: function (obj) { return 1; },
                            //records: function (obj) { return obj.d.length; },
                            root: function (obj) { return obj.d; },
                            repeatitems: false,
                            id: "0"
                        },
                        caption: 'Registro de Atenciones de Laboratorio...'
                    });
                }).navGrid("#pager", { edit: true, add: true, del: false });



                var detalleSolicitud = [];
                //$('.solo_numeros').soloPermitir('0123456789');

                $.ajax({
                    type: "POST",
                    async: false,
                    url: '/CartillaAtencion/listarCartillaAtencion/',
                    cache: false,
                    //data: JSON.stringify(data),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (data) {
                        console.log(data);
                        var $tableCartilla = $('<table/>');
                        $tableCartilla.append('<thead><tr><th>COMPROBANTE</th><th>NOMBRE CLIENTE</th><th>PACIENTE</th><th>NOMBRE EMPLEADO</th><th>CÓDIGO</th><th>FECHA CREACIÓN</th><th>ESTADO</th></tr></thead>');
                        var $tbodyCartilla = $('<tbody/>');
                        $.each(data, function (i, val) {
                            //alert("val:" + val.NUMCOM);
                            var $row = $('<tr/>');
                            $row.append($('<td/>').html(val.NUMCOM));
                            $row.append($('<td/>').html(val.NOMCLI));
                            $row.append($('<td/>').html(val.NOMPAC));
                            $row.append($('<td/>').html(val.NOMEMP));
                            $row.append($('<td/>').html(val.CODIGO));
                            $row.append($('<td/>').html(val.FECCRE));
                            $row.append($('<td/>').html(val.ESTCAR));

                            $tbodyCartilla.append($row);

                        });
                        $tableCartilla.append($tbodyCartilla);
                        $('#tabAtencionMedica').html($tableCartilla);
                    },
                    error: function (xqr, errorMessage) {
                        alert(errorMessage);
                    }
                });

            });


            function actualizarTabla() {

                $.ajax({
                    type: "POST",
                    async: false,
                    url: '/CartillaAtencion/listarCartillaAtencion/',
                    cache: false,
                    //data: JSON.stringify(data),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (data) {
                        console.log(data);
                        var $tableCartilla = $('<table/>');
                        $tableCartilla.append('<thead><tr><th>COMPROBANTE</th><th>NOMBRE CLIENTE</th><th>PACIENTE</th><th>NOMBRE EMPLEADO</th><th>CÓDIGO</th><th>FECHA CREACIÓN</th><th>ESTADO</th></tr></thead>');
                        var $tbodyCartilla = $('<tbody/>');
                        $.each(data, function (i, val) {
                            //alert("val:" + val.NUMCOM);
                            var $row = $('<tr/>');
                            $row.append($('<td/>').html(val.NUMCOM));
                            $row.append($('<td/>').html(val.NOMCLI));
                            $row.append($('<td/>').html(val.NOMPAC));
                            $row.append($('<td/>').html(val.NOMEMP));
                            $row.append($('<td/>').html(val.CODIGO));
                            $row.append($('<td/>').html(val.FECCRE));
                            $row.append($('<td/>').html(val.ESTCAR));

                            $tbodyCartilla.append($row);

                        });
                        $tableCartilla.append($tbodyCartilla);
                        $('#tabAtencionMedica').html($tableCartilla);
                    },
                    error: function (xqr, errorMessage) {
                        alert(errorMessage);
                    }
                });

            }

            function buscarComprobante() {
                var dataComprobante = {
                    numeroComprobante: $('#txtNumeroComprobante').val()
                }

                $.ajax({
                    type: "POST",
                    async: false,
                    url: '/CartillaAtencion/obtenerComprobante',
                    cache: false,
                    data: JSON.stringify(dataComprobante),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (data) {
                        console.log(data);
                        //alert("Longitud:" + data.length);
                        if (data.length != 0) {
                            $.each(data, function (i, val) {
                                $("#idComprobante").val(val.IDCOMP);
                                $("#idCliente").val(val.IDCLIE);
                                $("#idPaciente").val(val.IDPACI);
                                $("#dniCliente").html(val.DNI);
                                $("#nombreCliente").html(val.CLIENTE);
                                $("#telefonoCliente").html(val.TELEFONO);
                                $("#celularCliente").html(val.CELULAR);
                                $("#correoCliente").html(val.CORREO);
                                $("#nombrePaciente").html(val.PACIENTE);
                                $("#tipoPaciente").html(val.TIPPACIENTE);
                                $("#razaPaciente").html(val.RAZA);
                                $("#colorPaciente").html(val.COLOR);
                                buscarTipoExamen();
                                cargarComboJefeLaboratorio();
                            });
                        } else {
                            alertaComprobantePago();
                            //alert("Comprobante no válido o no encontrado, verifique en caja...");
                            limpiarComprobante();
                        }

                    },
                    error: function (xqr, errorMessage) {
                        alert(errorMessage);
                    }
                });

            }


            function cargarComboJefeLaboratorio() {
                //alert("Cargar Combo");
                var dataEmpleado = {
                    tipoEmpleado: 'Jefe Laboratorio',
                    sede: 'Lince'
                }

                $.ajax({
                    type: "POST",
                    async: false,
                    url: '/Empleado/listarEmpleado/',
                    cache: false,
                    //data: JSON.stringify(dataEmpleado),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (data) {
                        console.log(data);
                        //alert("Longitud:" + data.length);
                        $(".con-json select").empty();
                        $('.con-json select').append('<option value="0">-- Seleccione --</option>');
                        $.each(data, function (i, val) {
                            if ((val.cargo_empleado == 'JEFE LABORATORIO') && (val.sede == 'LINCE')) {
                                //alert(val.nombre_empleado);
                                $('.con-json select').append('<option value="' + val.id_empleado + '">' + val.nombre_empleado + '</option>');
                            }
                        });

                    },
                    error: function (xqr, errorMessage) {
                        alert(errorMessage);
                    }
                });

            }


            function buscarTipoExamen() {
                var dataTipoExamen = {
                    idComprobante: parseInt($('#idComprobante').val())
                }

                $.ajax({
                    type: "POST",
                    async: false,
                    url: '/TipoExamen/listarTipoExamen/',
                    cache: false,
                    data: JSON.stringify(dataTipoExamen),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (data) {
                        console.log(data);
                        if (data.length != 0) {
                            $('#cblist').empty();
                            $.each(data, function (i, val) {
                                //alert(val.tipo_examen);
                                addCheckbox(val.tipo_examen);
                                /*$('#cblist')
                                    .append(
                                        $(document.createElement('input')).attr({
                                            id: + 'txtlab_' + val.tipo_examen,
                                            name: + 'txtlab_' + val.tipo_examen,
                                            value: + val.tipo_examen,
                                            type: 'text'
                                        }) + '<br />'
                                    );*/
                            });
                        } else {
                            alert("Comprobante no válido o no encontrado, verifique en caja...");
                        }

                    },
                    error: function (xqr, errorMessage) {
                        alert(errorMessage);
                    }
                });
            }


            function addCheckbox(name) {
                var container = $('#cblist');
                var inputs = container.find('input');
                var id = inputs.length + 1;

                $('<input />', { type: 'text', id: 'cb' + id, value: name, disabled: true }).appendTo(container);
                //$('<label />', { 'for': 'cb' + id, text: name }).appendTo(container);
                $('<br />').appendTo(container);
            }

            function alertaComprobantePago() {
                //un alert
                alertify.alert("<b>Número de Comprobante de Pago no encontrado</b><br>por favor, acerquese a caja",
                    function () { }, 'popupAdvertencia');
            }


            var oAlert = alert;
            function alert(txt, title) {
                try {
                    jAlert(txt, title);
                } catch (e) {
                    oAlert(txt);
                }
            }


            function confirmar() {
                //un confirm
                alertify.confirm("<p>Esta seguro que desea grabar la Cartilla de Atención<br><br></p>", function (e) {
                    if (e) {
                        alertify.success("Has pulsado '" + alertify.labels.ok + "'");
                    } else {
                        alertify.error("Has pulsado '" + alertify.labels.cancel + "'");
                    }
                });
                return false
            }


            function limpiarComprobante() {
                $("#dniCliente").html("");
                $("#nombreCliente").html("");
                $("#telefonoCliente").html("");
                $("#celularCliente").html("");
                $("#correoCliente").html("");
                $("#nombrePaciente").html("");
                $("#tipoPaciente").html("");
                $("#razaPaciente").html("");
                $("#colorPaciente").html("");
                $('#cblist').empty();
                $("#idComprobante").val("");
                $("#idCliente").val("");
                $("#idPaciente").val("");
            }

            function grabarCartilla() {

                if (parseInt($('#cboJefes').val()) > 0) {

                    var cartilla = {
                        numero_comprobante: $('#txtNumeroComprobante').val(),
                        id_cliente: parseInt($("#idCliente").val()),
                        id_paciente: parseInt($("#idPaciente").val()),
                        id_empleado: parseInt($('#cboJefes').val())
                    }

                    $.ajax({
                        type: "POST",
                        async: false,
                        url: '/CartillaAtencion/guardarCartillaAtencion',
                        cache: false,
                        data: JSON.stringify(cartilla),
                        dataType: "JSON",
                        contentType: "application/json",
                        success: function (data) {
                            if (data == "OK") {
                                alertify.alert("<b>Se registró la Cartilla de Atención satisfactoriamente.</b><br>");
                            } else {
                                alertify.error("<b>Ocurrió un inconveniente al crear la Cartilla de Atención.</b><br>");
                            }
                            $("#myModal").hide();
                            limpiarComprobante();
                            //actualizarTabla();
                            location.reload();

                        },
                        error: function (xqr, errorMessage) {
                            alertify.error("<b>Ocurrió un inconveniente al crear la Cartilla de Atención.</b><br>");
                        }
                    });
                } else {
                    alertify.alert("<b>Debe ingresar todos los datos</b>",
                    function () { }, 'popupAdvertencia');
                }
            }


            function filtroBuscar() {

                if ($("#cboEstado option:selected").html() == 'TODOS') {
                    mostrarCartillaAtencion();
                    return false;
                }
                /*var Cliente = {
                    nombre: $('#txtNombrePaciente').val()
                }*/

                var Paciente = {
                    nombre: $('#txtNombrePaciente').val().toUpperCase()
                }

                var filtro = {
                    numero_comprobante: $('#txtComprobantePago').val(),
                    //nombre_cliente: $('#txtNombreCliente').val(),
                    Paciente: Paciente,
                    //nombre_empleado: $('#txtNombreEmpleado').val(),
                    codigo: $('#txtCodigoCartilla').val(),
                    estado_cartilla: $("#cboEstado option:selected").html(),
                    desde_day: $('#desdeDay').val(),
                    hasta_day: $('#hastaDay').val()
                }

                //alertify.alert("Comprobante_Pago: " + filtro.numero_comprobante + "<BR>Nombre Paciente: " + filtro.nombre_paciente);

                $.ajax({
                    type: "POST",
                    async: false,
                    url: '/CartillaAtencion/buscarCartillaAtencion',
                    cache: false,
                    data: JSON.stringify(filtro),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (data) {
                        console.log(data);
                        if (data.length != 0) {
                            alertify.alert("<b>La búsqueda fue satisfactoria.</b><br>");
                            $('#cbtable').empty();
                            var $tableCartilla = $('<table/>');
                            $tableCartilla.append('<thead><tr><th>COMPROBANTE</th><th>NOMBRE CLIENTE</th><th>PACIENTE</th><th>NOMBRE EMPLEADO</th><th>CÓDIGO</th><th>FECHA CREACIÓN</th><th>ESTADO</th></tr></thead>');
                            var $tbodyCartilla = $('<tbody/>');
                            $.each(data, function (i, val) {
                                //alert("val:" + val.NUMCOM);
                                var $row = $('<tr/>');
                                $row.append($('<td/>').html(val.NUMCOM));
                                $row.append($('<td/>').html(val.NOMCLI));
                                $row.append($('<td/>').html(val.NOMPAC));
                                $row.append($('<td/>').html(val.NOMEMP));
                                $row.append($('<td/>').html(val.CODIGO));
                                $row.append($('<td/>').html(val.FECCRE));
                                $row.append($('<td/>').html(val.ESTCAR));

                                $tbodyCartilla.append($row);

                            });
                        } else {
                            var $tableCartilla = $('<table/>');
                            $tableCartilla.append('<thead><tr><th>COMPROBANTE</th><th>NOMBRE CLIENTE</th><th>PACIENTE</th><th>NOMBRE EMPLEADO</th><th>CÓDIGO</th><th>FECHA CREACIÓN</th><th>ESTADO</th></tr></thead>');
                            var $tbodyCartilla = $('<tbody/>');
                            var $row = $('<tr/>');
                            $row.append($('<td colspan="7"/>').html("No existen datos para la consulta realizada..."));
                            $tbodyCartilla.append($row);
                        }
                        $tableCartilla.append($tbodyCartilla);
                        $('#tabAtencionMedica').html($tableCartilla);
                    },
                    error: function (xqr, errorMessage) {
                        alertify.error("<b>Ocurrió un inconveniente al buscar la Cartilla de Atención.</b><br>");
                    }
                });
            }

            function limpiarCamposBusqueda() {
                $('#txtCodigoCartilla').val("");
                $('#txtComprobantePago').val("");
                $('#txtNombreCliente').val("");
                $('#txtNombrePaciente').val("");
                $('#txtNombreEmpleado').val("");
                $('#txtNombreEmpleado').val("");
                $('#txtNombreEmpleado').val("");
                $('#cboEstado option[value="0"]').attr('selected', 'selected');
                $('input[type=date]').each(function resetDate() {
                    this.value = this.defaultValue;
                });
                if ($("#cboEstado option:selected").html() == 'TODOS')
                    $('#cboEstado option[value="0"]').attr('selected', 'selected');
            }


            function mostrarCartillaAtencion() {
                actualizarTabla();
            }

        </script>
	</body>
</html>



<style>
    /*Adding some css for looks good*/
    span.error {
        display: block;
        visibility: hidden;
        color: red;
        font-size: 90%;
    }


    /*css for table*/
    .container td {
        vertical-align: top;
    }

    .tablecontainer table {
        width: 100%;
        border-collapse: collapse;
        border-top: 1px solid #BFAEAE;
        border-right: 1px solid #BFAEAE;
    }

    .tablecontainer th {
        border-bottom: 2px solid #BFAEAE !important;
    }

    .tablecontainer th, .tablecontainer td {
        text-align: left;
        border-left: 1px solid #BFAEAE;
        padding: 5px;
        border-bottom: 1px solid #BFAEAE;
    }

    .ui-widget {
        font-size: 12px !important;
    }

</style>