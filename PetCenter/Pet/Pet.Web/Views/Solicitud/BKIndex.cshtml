<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Pet Center - Gestion de Ordenes de Compra</title>
		<link href="css/bootstrap.css" rel="stylesheet">
		<link href="css/font-awesome.min.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">
        <link href="css/jquery-ui.css" rel="stylesheet" />
       
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

	</head>
	<body>
		<div id="header">
			<div class="logo-group">
				<span class="logo"> <img src="img/petcenter.png"> </span>
				<span class="nombre-sistema"> </span>
			</div>
			<div class="user-group">
				<div id="logout" class="btn-header salir">
					<span> <a href="login.html" title="Cerrar sesión"><i class="fa fa-sign-out"></i></a> </span>
				</div>
				<div class="usuario hidden-xs text-right">
					<div class="usuario-nombre">Luis Jimenez</div>
					<div class="cargo">Administrador</div>
				</div>
			</div>
		</div>

		<div id="menu-prin">
			<ul class="nav nav-stacked" id="accordion1">
				<li class="panel">
					<a href="#"><i class="fa fa-lg fa-fw fa-home"></i> Inicio</a>
				</li>
				<li class="panel active">
					<a data-toggle="collapse" data-parent="#accordion1" href="#ini-generabase" aria-expanded="true"><i class="fa fa-lg fa-fw fa-cube"></i> Generar solicitud <b><em class="fa mas-menos"></em></b></a>
					<ul id="ini-generabase" class="collapse in" aria-expanded="true">
						<li><a href="#">Inicio</a></li>
						<li ><a href="#">Recurso</a></li>
						<li class="active"><a href="#">Solicitud</a></li>
					</ul>
				</li>
				<li class="panel">
					<a href="#"><i class="fa fa-lg fa-fw fa-cubes"></i> Mis Solicitudes</a>
				</li>
				<li class="panel">
					<a href="#"><i class="fa fa-lg fa-fw fa-sign-out"></i> Salir</a>
				</li>
			</ul>
		</div>

		<div id="cuerpo">
			<div id="content">
				<div class="row">

					<div class="col-xs-12 col-sm-7 col-md-8 col-lg-8">
						<div class="row">
							<div class="container-fluid text-left">
								<span class="h1-resultados page-title">Solicitud </span>

							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-sm-12">
						<div class="well">

							<div class="row">
								<div class="smart-form">
									<div class="col-sm-12 text-left">
										<button type="submit" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#myModal">
											Agregar
										</button>
									</div>
								</div>
							</div>
							<div class="separa-20"></div>
							<div class="row">
								<div class="col-xs-12">
                                    <div id="tabSolicitud" class="tablecontainer"></div>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
		  <div class="modal-dialog">
		    <!-- Modal content-->
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal">&times;</button>
		    		<strong>Registro de Solicitud</strong>
		      </div>

					<div class="panel-body">
							<div class="row">
								<div class="col-sm-3">N° Solicitud</div>
								<div class="col-sm-6">
										<label class="input">
												<input type="text" id="txtCodigo"  name="txtCodigo"  placeholder="Nro Solicitud" disabled>
                                		</label>
								</div>
                            </div>
                            <div class="row">
									<div class="col-sm-3">Fecha</div>
									<div class="col-sm-6" >
											<label class="input">
													<input type="text"  id="txtFecha"  name="txtFecha" d>
                        					</label>
                                        <span class="error" style="visibility:hidden">Seleccione fecha</span>
									</div>

							</div>

							<div class="row">
									<div class="col-sm-3">Prioridad</div>
									<div class="col-sm-6">
											<label class="select">
												<select id="cboPrioridad" name="cboPrioridad">
                                                </select> 
											</label>
                                        <span class="error" style="visibility:hidden">Seleccione prioridad</span>
									</div>
                            </div>
                            <div class="row">
                                    <div class="col-sm-3">Estado</div>
									<div class="col-sm-6">
											<label class="select">
                                                <select id="cboEstado" name="cboEstado" ">
                                                    
                                                </select>
											</label>
                                        <span class="error" style="visibility:hidden">Seleccione estado</span>
									</div>
                            </div>
                            <div class="row">
									<div class="col-sm-3"></div>
									<div class="col-sm-6">
											<button type="submit" id="btnGuardar" class="btn btn-sm">Guardar</button>
											<button type="button" class="btn btn-sm" data-dismiss="modal"> Cerrar</button>
									</div>
							</div>
                            <div class="separa-20"></div>
                     
							<div class="row">
								<div class="col-xs-12">
									<table class="table table-striped table-hover">
                                        <thead >
                                            <tr style="background-color:#FFD54F">
                                                <td>Producto:</td>
                                                <td> <label class="select">
                                                        <select id="cboProducto"  style="width:180px">
										            
                                                
                                                    </select>
                                                <span class="error" style="visibility:hidden">Seleccione producto</span>
                                                    </label>
                                                </td>
                                                <td>Cantidad:</td>
                                                <td>
                                                    <label class="select">
                                                    <input type="text" id="txtCantidad"   name="txtCantidad"  placeholder="Cantidad"  style="width:60px">
                                                     <span class="error" style="visibility:hidden">Ingrese cantidad</span>
                                                    </label>
                                                </td>
                                                <td><button type="submit" id="addDetalle" class="btn btn-sm btn-default" ">Agregar</button></td>
                                            </tr>
										
										</thead>
                                        </table>
                                        	
                                </div>			
					        </div>
               <div id="detalle" class="tablecontainer">
                    <table class="table table-responsive" id="detalleSolicitud"></table>
                    <span id="numeroSolicitudError" style="color:red"></span>
               </div>
		      <div class="modal-footer">
				
		      </div>
		    </div>
		  </div>
		</div>
        </div>
     @*   <script src="Scripts/jquery-1.8.2.js"></script>
        <script src="Scripts/knockout-2.2.0.js"></script>
        <script src="Scripts/knockout.mapping-latest.js"></script>
       *@
       
        @* <script src="Scripts/jquery-ui.js"></script>
        <link href="Scripts/jquery-ui.css" rel="stylesheet" />
        *@
        <script src="js/external/jquery/jquery.js"></script>
        <link href="Scripts/jquery-ui.min.css" rel="stylesheet" />
        <script src="Scripts/jquery-ui.min.js"></script>
        <script src="Scripts/solicitud.js"></script>

@*         <script src="js/jquery.min.js"></script>*@
		<script src="js/bootstrap.min.js"></script>
		<script src="js/bootswatch.js"></script>

        <script>
            //Date Picker
            $(function () {
                $('#txtFecha').datepicker({
                    dateFormat : 'mm-dd-yy'
                });
            });

            $(document).ready(function () {

                //$('.solo_numeros').soloPermitir('0123456789');

                $.getJSON("/Solicitud/ListaSolicitud").done(function (data) {

                    var $table = $('<table/>');
                    $table.append('<thead><tr><th>Solitud</th><th>Fecha</th><th>Prioridad</th><th>Usuario</th><th>Estado</th><th>Acción</th></tr></thead>');
                    var $tbody = $('<tbody/>');
                    $.each(data, function (i, val) {
                        var $row = $('<tr/>');
                        $row.append($('<td/>').html(val.numero_solicitud));
                        $row.append($('<td/>').html(val.fecha_hora));
                        $row.append($('<td/>').html(val.prioridad));
                        $row.append($('<td/>').html(val.usuario));
                        $row.append($('<td/>').html(val.codigo_estado));

                        $row.append($('<td/>').html(
                           "<a class='editar' href='#'><i class='glyphicon glyphicon-edit' title='Editar'></i></a><a class='editar' href='#'><i class='glyphicon glyphicon-user' title='Estatus'></i></a><a class='editar' href='#'><i class='glyphicon glyphicon-trash' title='Eliminar'></i></a>"));
                        $tbody.append($row);
                    });
                    $table.append($tbody);
                    $('#tabSolicitud').html($table);

                });


            

              

                var detalleSolicitud = [];
                $('#addDetalle').click(function () {
                    
                    alert($("#cboProducto").val());

                    var isValidItem = true;
                    if ($('#cboProducto').val() == '0') {
                        isValidItem = false;
                        $('#cboProducto').siblings('span.error').css('visibility', 'visible');
                    }
                    else {
                        $('#cboProducto').siblings('span.error').css('visibility', 'hidden');
                    }

                    if (!($('#txtCantidad').val().trim() != '' && !isNaN($('#txtCantidad').val().trim()))) {
                        isValidItem = false;
                        $('#txtCantidad').siblings('span.error').css('visibility', 'visible');
                    }
                    else {
                        $('#txtCantidad').siblings('span.error').css('visibility', 'hidden');
                    }
                    if (isValidItem) {
                        detalleSolicitud.push({
                            item: 0,
                            cantidad_solicitada: parseInt($('#txtCantidad').val().trim()),
                            codigo_recurso: $("#cboProducto").val(),
                            nombre_recurso: $("#cboProducto option:selected").text()
                        });

                        $('#cboProducto').val('').focus();
                        $('#txtCantidad').val('');

                        GeneraDetalleSolicitud();
                    }
                   
                   

                    function GeneraDetalleSolicitud() {
                        if (detalleSolicitud.length > 0) {
                            var $table = $('<table/>');
                            $table.append('<thead><tr><th>Item</th><th>Producto</th><th>Descripcion</th><th>Cantidad</th><th>Acción</th></tr></thead>');
                            var $tbody = $('<tbody/>');
                            $.each(detalleSolicitud, function (i, val) {
                                var $row = $('<tr/>');
                                $row.append($('<td/>').html(val.item));
                                $row.append($('<td/>').html(val.codigo_recurso));
                                $row.append($('<td/>').html(val.nombre_recurso));
                                $row.append($('<td/>').html(val.cantidad_solicitada));
                                $row.append($('<td/>').html("<a class='editar' href='#'><i class='glyphicon glyphicon-trash' title='Eliminar'></i></a>"));
                                $tbody.append($row);
                            });
                            $table.append($tbody);
                            $('#detalleSolicitud').html($table);
                        }
                    }

                    $('#btnGuardar').click(function () {
                        //validation of order
                        var isAllValid = true;
                        if (detalleSolicitud.length == 0) {
                            $('#detalleSolicitud').html('<span style="color:red;">Agregue productos</span>');
                            isAllValid = false;
                        }

                        if ($('#txtFecha').val().trim() == '') {
                            $('#txtFecha').siblings('span.error').css('visibility', 'visible');
                            isAllValid = false;
                        }
                        else {
                            $('#txtFecha').siblings('span.error').css('visibility', 'hidden');
                        }

                        if ($('#cboPrioridad').val().trim() == '') {
                            $('#cboPrioridad').siblings('span.error').css('visibility', 'visible');
                            isAllValid = false;
                        }
                        else {
                            $('#cboPrioridad').siblings('span.error').css('visibility', 'hidden');
                        }
                        if ($('#cboEstado').val().trim() == '') {
                            $('#cboEstado').siblings('span.error').css('visibility', 'visible');
                            isAllValid = false;
                        }
                        else {
                            $('#cboEstado').siblings('span.error').css('visibility', 'hidden');
                        }
                        //Save if valid
                        if (isAllValid) {
                            var data = {
                                numero_solicitud: $('#txtCodigo').val().trim(),
                                fecha_hora: $('#txtFecha').val().trim(),
                                codigo_prioridad: $('#cboPrioridad').val(),
                                codigo_prioridad: $('#cboPrioridad').val(),
                                codigo_estado: $('#cboEstado').val(),
                                GPC_DetalleDeSolicitud: detalleSolicitud
                            }

                            $(this).val('Please wait...');

                            $.ajax({
                                url: '/Solicitud/GuardaSolicitud',
                                type: "POST",
                                data: JSON.stringify(data),
                                dataType: "JSON",
                                contentType: "application/json",
                                success: function (d) {
                                    //check is successfully save to database 
                                    if (d.status == true) {
                                        //will send status from server side
                                        alert('Successfully done.');
                                        //clear form
                                        detalleSolicitud = [];
                                        $('#txtCOdigo').val('');
                                        $('#txtFecha').val('');
                                        $('#detalleSolicitud').empty();
                                    }
                                    else {
                                        alert('Failed');
                                    }
                                    $('#submit').val('Save');
                                },
                                error: function () {
                                    alert('Error. Please try again.');
                                    $('#btnGuardar').val('Guardar');
                                }
                            });
                        }

                    });

                    $(".glyphicon").bind("click", function (event) {
                        var target_row = $(this).parent().parent().parent();
                        var aPos = oTable.fnGetPosition(target_row); // the error occurs here!
                        oTable.fnDeleteRow(aPos);
                    });

                });
            });
        </script>

	</body>
</html>



<style>
    /*Adding some css for looks good*/
    span.error {
        display:block;
        visibility:hidden;
        color:red;
        font-size:90%;
    }


    /*css for table*/
    .container td {
        vertical-align: top;
    }
    .tablecontainer table {
        width: 100%;
        border-collapse: collapse;
        border-top: 1px solid #BFAEAE;
        border-right: 1px solid #BFAEAE;
    }
    .tablecontainer th {
        border-bottom: 2px solid #BFAEAE !important;
    }
    .tablecontainer th, .tablecontainer td {
        text-align: left;
        border-left: 1px solid #BFAEAE;
        padding: 5px;
        border-bottom: 1px solid #BFAEAE;
    }
    .ui-widget {
        font-size:12px !important;
    }
</style>